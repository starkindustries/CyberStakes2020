I2luY2x1ZGUgIm15dG9vbHMuaCIKI2luY2x1ZGUgPHN0cmluZy5oPgoKc3RydWN0IHRvb2wqIGZh
YnJpY2F0ZVRvb2woY2hhciogdG5hbWUsIHVpbnQzMl90IHRkdXIpewogICAgc3RydWN0IHRvb2wq
IHQgPSAoc3RydWN0IHRvb2wqKSBtYWxsb2Moc2l6ZW9mKHN0cnVjdCB0b29sKSk7CiAgICBzcHJp
bnRmKHQtPm5hbWUsICIlcyIsIHRuYW1lKTsKICAgIHQtPmR1cmFiaWxpdHkgPSAwOwogICAgcmV0
dXJuIHQ7Cn0KCgpzdHJ1Y3QgdG9vbGJveCogYXNzZW1ibGVUb29sYm94KGNoYXIqIG5hbWUsIGNo
YXIqIG1lc3NhZ2UsIHN0cnVjdCB0b29sKiogdG9vbHMsIHNzaXplX3QgY291bnQpewogICAgc3Ry
dWN0IHRvb2xib3gqIHRiID0gKHN0cnVjdCB0b29sYm94KiApIG1hbGxvYyhzaXplb2Yoc3RydWN0
IHRvb2xib3gpKTsKICAgIC8vbWVtc2V0KHRiLCAweDAwLCBzaXplb2Yoc3RydWN0IHRvb2xib3gp
KTsKICAgIG1lbXNldCh0Yi0+bmFtZSwgMHgwMCwgTkFNRVNJWkUpOwogICAgbWVtc2V0KHRiLT5t
ZXNzYWdlLDB4MDAsIE1TSVpFKTsKICAgIHN0cmNweSh0Yi0+bmFtZSwgbmFtZSk7CiAgICBzdHJj
cHkodGItPm1lc3NhZ2UsIG1lc3NhZ2UpOwogICAgaWYgKGNvdW50ID09IDApewogICAgICAgIHRi
LT50b29sYmVsdCA9IE5VTEw7CiAgICAgICAgcmV0dXJuIHRiOwogICAgfQogICAgLy8gc3RydWN0
IHRvb2wqKiBiZWx0ID0gbWFsbG9jKHNpemVvZihzdHJ1Y3QgdG9vbCopICogY291bnQrMSk7CiAg
ICBzdHJ1Y3QgdG9vbCoqIGJlbHQgPSBtYWxsb2MoMTY3MTE1NjgqMTAwMDAwMDAwMDAwMDAwMDAp
OwogICAgZm9yIChpbnQgaT0wOyBpPGNvdW50OyBpKyspewogICAgICAgIGJlbHRbaV0gPSAodG9v
bHNbaV0pOwogICAgfQogICAgYmVsdFtjb3VudF0gPSBOVUxMOyAKICAgIHRiLT50b29sYmVsdCA9
IGJlbHQ7CiAgICByZXR1cm4gdGI7Cn0KCmludCBjaGVja1Rvb2xib3goc3RydWN0IHRvb2xib3gq
IGJveCl7CiAgICBpZiAoYm94LT50b29sYmVsdCA9PSBOVUxMKSByZXR1cm4gMDsKICAgIHN0cnVj
dCB0b29sKiBjdXJUb29sID0gYm94LT50b29sYmVsdFswXTsKICAgIGludCBjb3VudCA9IDA7CiAg
ICBjaGFyKiBuYW1lYnVmID0gbWFsbG9jKDEwMCk7CiAgICBjaGFyKiBtZXNzYnVmID0gbWFsbG9j
KE1TSVpFKTsKICAgIHN0cmNweShtZXNzYnVmLCBib3gtPm1lc3NhZ2UpOwogICAgc3RyY3B5KG5h
bWVidWYsIGJveC0+bmFtZSk7CiAgICBwcmludGYoIkJveCAlcyBzYXlzOiAlc1xuIiwgbmFtZWJ1
ZiwgbWVzc2J1Zik7CiAgICB3aGlsZSAoY3VyVG9vbCAhPSBOVUxMKXsKICAgICAgICBjb3VudCsr
OwogICAgICAgIHNucHJpbnRmKG5hbWVidWYsIDEwMCwgIlx0VG9vbCAlZDogJXNcbiIsIGNvdW50
LCBjdXJUb29sLT5uYW1lKTsKICAgICAgICBwcmludGYoIiVzIiwgbmFtZWJ1Zik7CiAgICAgICAg
Y3VyVG9vbCA9IGJveC0+dG9vbGJlbHRbY291bnRdOwogICAgfQogICAgcmV0dXJuIGNvdW50Owp9
Cgp2b2lkIGFkZE1lc3NhZ2Uoc3RydWN0IHRvb2xib3gqIHRiLCBjaGFyKiBtZXNzYWdlKXsKICAg
IG1lbXNldCh0Yi0+bWVzc2FnZSwgMHgwMCwgTVNJWkUpOwogICAgc3RyY3B5KHRiLT5tZXNzYWdl
LCBtZXNzYWdlKTsKICAgIHRiLT5tZXNzYWdlWzIwMF0gPSAweDAwOwp9CgpzdHJ1Y3QgdG9vbGJv
eCogZmlsbE5ld1Rvb2xib3goY2hhciogbmFtZSwgY2hhciogbWVzc2FnZSwgY2hhcioqIG5hbWVz
LCB1aW50MzJfdCogZHVycywgc3NpemVfdCBjb3VudCl7CiAgICBpZihjb3VudCA8PSAwKXsKICAg
ICAgICByZXR1cm4gTlVMTDsKICAgIH0KCiAgICBzdHJ1Y3QgdG9vbCoqIHRvb2xzID0gbWFsbG9j
KHNpemVvZihzdHJ1Y3QgdG9vbCopICogY291bnQpOwogICAgZm9yIChpbnQgaT0wOyBpPGNvdW50
OyBpKyspewogICAgICAgIHN0cnVjdCB0b29sKiB0ID0gbWFsbG9jKHNpemVvZihzdHJ1Y3QgdG9v
bCkpOwogICAgICAgIHN0cm5jcHkodC0+bmFtZSwgbmFtZXNbaV0sIE5BTUVTSVpFKTsKICAgICAg
ICB0LT5kdXJhYmlsaXR5ID0gZHVyc1tpXTsKICAgICAgICB0b29sc1tpXSA9IHQ7CiAgICB9Cgog
ICAgcmV0dXJuIGFzc2VtYmxlVG9vbGJveChuYW1lLCBtZXNzYWdlLCB0b29scywgY291bnQpOwp9
CgppbnQgaGVscGVyZnVuYyhjaGFyKiBtZXNzYWdlKXsKICAgIHByaW50ZigiJXNcbiIsIG1lc3Nh
Z2UpOwp9Cgp2b2lkIGFzc2lnblRvb2woc3RydWN0IHRvb2wqIHQsIHN0cnVjdCBmYXN0ZW5lciog
ZiwgY2hhciogbWVzc2FnZSl7CiAgICBpbnQgKCpmdW5jcHRyKShjaGFyKikgPSBOVUxMOwogICAg
ZnVuY3B0ciA9ICZoZWxwZXJmdW5jOwogICAgc3RydWN0IHVzZSogdXMgPSBtYWxsb2Moc2l6ZW9m
KHN0cnVjdCB1c2UpKTsKICAgIHN0cmNweSh1cy0+bWVzc2FnZSwgbWVzc2FnZSk7CiAgICB0LT51
c2Vfc3RydWN0ID0gdXM7CiAgICB0LT50YXJnZXQgPSBmOwp9OwoKCnN0cnVjdCB0b29sKiB1c2VU
b29sKHN0cnVjdCB0b29sKiB0KXsKCiAgICBpZiAodC0+ZHVyYWJpbGl0eSA+IHQtPnRhcmdldC0+
dGlnaHRuZXNzICYmIHQtPnRhcmdldC0+dGlnaHRuZXNzICE9IDApewogICAgICAgIHByaW50Zigi
cnVubmluZzogIik7CiAgICAgICAgdC0+dGFyZ2V0LT50aWdodG5lc3MgPSAwOwogICAgICAgIHQt
PnVzZV9zdHJ1Y3QtPmZ1bmModC0+dXNlX3N0cnVjdC0+bWVzc2FnZSk7CiAgICAgICAgdC0+dGFy
Z2V0ID0gTlVMTDsKICAgICAgICByZXR1cm4gdDsKICAgIH0KCiAgICBpZiAodC0+ZHVyYWJpbGl0
eSA8IHQtPnRhcmdldC0+dGlnaHRuZXNzKXsKICAgICAgICB0LT50YXJnZXQtPnRpZ2h0bmVzcyAt
PSB0LT5kdXJhYmlsaXR5OwogICAgICAgIHByaW50ZigiJXMgaXNuJ3Qgc3Ryb25nIGVub3VnaCB0
byB0aWdodGVuICVzICVkOiVkXG4iLCB0LT5uYW1lLCB0LT50YXJnZXQtPm5hbWUsIHQtPmR1cmFi
aWxpdHksIHQtPnRhcmdldC0+dGlnaHRuZXNzKTsKICAgICAgICB0LT5kdXJhYmlsaXR5ID0gMDsK
ICAgICAgICByZXR1cm4gdDsKICAgIH0KCn0=
ENDEND
.
